---
id: gitlab-ci
title: Gitlab CI
---

### Using GitLab CI

1. Generate a Personal Access Token with "Read Repository" and "Write Repository" permissions (this will be `GL_TOKEN`).
1. Generate `BIT_TOKEN` by grabbing it from your local "bit config" output.
1. Configure both tokens as project variables for your GitLab project and name them `GL_TOKEN` and `BIT_USER_TOKEN`.
1. Create a `.gitlab-ci.yml` file in the root of the repository.
1. Create your script.

Here's a demo script you can start with:

```yml
publish_components:
  image: node:latest
  only: master
  script:
    # Install Bit and configure permissions
    - npm i -g @teambit/bvm
    - bvm install
    - export PATH=$HOME/bin:$PATH
    - bit config set analytics_reporting false
    - bit config set anonymous_reporting false
    - bit config set user.token $BIT_TOKEN
    # Install dependencies
    - bit install
    # Version all pending components
    - bit tag --persist
    # Export components
    - bit export
    # Setup Git and commit back .bitmap changes
    - git config --global user.email "some@email.address"
    - git config --global user.name "some ci account"
    - export GL_RELEASE_GITLAB_API_TOKEN=$GL_TOKEN
    # This checkout is a workaround for the "error: src refspec master does not match any." error
    - git checkout master
    # Add the modified ".bitmap" file
    - git add .
    # Replace origin with authenticated origin
    - git remote rm origin
    - git remote add origin https://[repo-owner]:$GL_RELEASE_GITLAB_API_TOKEN@gitlab.com/[repo-ower]/[repo-name].git
    # Using [skip ci] as its a feature for GitLab that will not trigger CI for this commit
    - git commit -am 'publish components [skip ci]'
    - git pull origin master
    - git push origin master
```
